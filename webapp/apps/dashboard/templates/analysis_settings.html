{% extends 'partials/dashboard/dashboard_base.html' %}
{% load static %}

{% block extra_css %}
    <!-- select2 css -->
    <link href="{% static 'libs/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- bootstrap-datepicker css -->
    <link href="{% static 'libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet">

    <!-- DataTables -->
    <link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- Responsive datatable examples -->
    <link href="{% static 'libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />

{% endblock %}

{% block page-header %}
Analysis
{% endblock %}
{% block main-path %}
Dashboard
{% endblock %}
{% block sub-path %}
Analysis Settings
{% endblock %}
{% block contents %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-3">Analysis Settings</h4>
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
                      <li class="nav-item">
                          <a class="nav-link active" data-bs-toggle="tab" href="#create-settings" role="tab">
                              Create
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="tab" href="#view-settings" role="tab">
                              View
                          </a>
                      </li>
                  </ul>

                  <!-- Tab panes -->
                  <div class="tab-content p-3">

                      <div class="tab-pane active" id="create-settings" role="tabpanel">
                        <form id="add-setting-form">
                            <div class="row">

                              <div class="col-xl col-sm-6">
                                  <div class="form-group mt-3 mb-0">
                                      <label>Ticker</label>
                                      <select id="select-ticker" class="form-control select2-search-disable" required>
                                          {% for stock in stocks %}
                                              <option value="{{stock.ticker}}">{{stock.ticker}}</option>
                                          {% endfor %}
                                      </select>
                                  </div>
                              </div>

                                <div class="col-xl col-sm-6">
                                    <div class="form-group mt-3 mb-0">
                                        <label>Function</label>
                                        <select id="select-function" class="form-control select2-search-disable" required>
                                            {% for func in functions %}
                                                <option value="{{func.name}}">{{func.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                <div class="col-xl col-sm-6 align-self-end">
                                    <div class="mt-3">
                                        <button type="submit" class="btn btn-primary w-md">Add Trend</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="save-settings-form">
                          {% csrf_token %}
                          <div class="table-responsive mt-5">
                            <table id="create-setting-datatable" class="table table-hover datatable dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                              <thead class="table-light">
                                <tr>
                                  <th class="align-middle">Stock Ticker</th>
                                  <th class="align-middle">Function</th>
                                  <th class="align-middle">Function Details</th>
                                  <th class="align-middle">Action</th>
                                </tr>
                              </thead>
                              <tbody></tbody>
                            </table>
                          </div>



                          <div class="row justify-content-end">
                            <div class="col-lg-20">
                              <label>Analysis Setting Name:</label>
                              <input type="text" id="analysis-name" name="analysis-name"></input>
                              <button type="submit" class="btn btn-primary">Save Analysis Setting</button>

                            </div>
                          </div>
                        </form>
                      </div>
                      <!-- END First tab panel -->
                      <!-- second tab panel -->
                      <div class="tab-pane" id="view-settings" role="tabpanel">
                          <div class="table-responsive mt-4">
                              <table class="table table-hover datatable dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                  <thead>
                                    <tr>
                                        <th class="align-middle">Analysis ID</th>
                                        <th class="align-middle">Analysis Name</th>
                                        <th class="align-middle">Created Date</th>
                                        <th class="align-middle">View Details</th>
                                        <th class="align-middle">Action</th>
                                    </tr>

                                  </thead>

                                  <tbody>
                                    {% for as in analysis_settings %}
                                      <tr>
                                          <td><a href="javascript: void(0);" class="text-body fw-bold">{{as.id}}</a> </td>
                                          <td>{{as.name}}</td>
                                          <td>{{as.created_date}}</td>
                                          <td>
                                              <!-- Button trigger modal -->
                                              <button type="button" class="btn btn-primary btn-sm btn-rounded" data-bs-toggle="modal" data-bs-target=".settingsModal-{{as.id}}">
                                                  View Details
                                              </button>
                                          </td>
                                          <td>
                                              <div class="d-flex gap-3">
                                                  <a href="javascript:void(0);" class="text-success"><i class="mdi mdi-pencil font-size-18"></i></a>
                                                  <a href="javascript:void(0);" class="text-danger"><i class="mdi mdi-delete font-size-18"></i></a>
                                              </div>
                                          </td>
                                      </tr>
                                    {% endfor %}


                                  </tbody>
                              </table>
                          </div>
                      </div>
                      <!-- end second tab panel -->
                  </div>


            </div>
        </div>
    </div>
</div>
<!-- end row -->


{% for as in analysis_settings %}
<!-- Modal -->
<div class="modal fade settingsModal-{{as.id}}" tabindex="-1" role="dialog" aria-labelledby=orderdetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id=orderdetailsModalLabel">Analysis Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-2">Analysis id: <span class="text-primary">{{as.id}}</span></p>
                <p class="mb-4">Analysis Name: <span class="text-primary">{{as.name}}</span></p>
                <div class="table-responsive">
                    <table class="table align-middle table-nowrap">
                        <thead>
                            <tr>
                              <th scope="col">Ticker</th>
                              <th scope="col">Function</th>
                            </tr>
                        </thead>
                        <tbody>
                          {% for ticker, function in as.zipped %}
                            <tr>
                                <td>{{ticker}}</td>
                                <td>{{function}}</td>
                            </tr>
                          {% endfor %}
                        </tbody>
                    </table>
                </div>
                <a href = "{% url 'analysis' analysis_id=as.id %}"><button type="button" class="btn btn-primary btn-sm btn-rounded">View Analysis</button></a>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- end modal -->
{% endfor %}




{% endblock %}
{% block extra_javascript %}

    <!-- select2 -->
    <script src="{% static 'libs/select2/js/select2.min.js' %}"></script>

    <!-- Required datatable js -->
    <script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
    <script>
      $.ajaxSetup({
        data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
      });
      var success_url = "{% url 'analysis_redirect'  %}"
    </script>
    <!-- init js -->
    <script src="{% static 'js/dashboard/analysis_settings.init.js' %}"></script>

{% endblock %}
